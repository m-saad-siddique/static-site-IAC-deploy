<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebGL Deployment - Complete Guide</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem 1rem;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 3rem 2rem;
      text-align: center;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }

    header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .content {
      padding: 2rem;
    }

    .toc {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 1.5rem;
      margin: 2rem 0;
      border-radius: 6px;
    }

    .toc h2 {
      color: #667eea;
      margin-bottom: 1rem;
      font-size: 1.5rem;
    }

    .toc ul {
      list-style: none;
      margin-left: 0;
    }

    .toc li {
      margin: 0.5rem 0;
    }

    .toc a {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }

    .toc a:hover {
      text-decoration: underline;
    }

    section {
      margin-bottom: 3rem;
      scroll-margin-top: 2rem;
    }

    h2 {
      color: #667eea;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 3px solid #667eea;
    }

    h3 {
      color: #764ba2;
      font-size: 1.4rem;
      margin: 1.5rem 0 1rem;
    }

    h4 {
      color: #555;
      font-size: 1.1rem;
      margin: 1rem 0 0.5rem;
    }

    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #2196F3;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
    }

    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
    }

    .success-box {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
    }

    .code-block {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 1rem;
      border-radius: 6px;
      overflow-x: auto;
      margin: 1rem 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .code-block code {
      color: #f8f8f2;
    }

    .step-list {
      counter-reset: step-counter;
      list-style: none;
      margin-left: 0;
    }

    .step-list li {
      counter-increment: step-counter;
      margin: 1rem 0;
      padding-left: 2.5rem;
      position: relative;
    }

    .step-list li::before {
      content: counter(step-counter);
      position: absolute;
      left: 0;
      background: #667eea;
      color: white;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }

    table th {
      background: #667eea;
      color: white;
      padding: 1rem;
      text-align: left;
    }

    table td {
      padding: 1rem;
      border-bottom: 1px solid #dee2e6;
    }

    table tr:hover {
      background: #f8f9fa;
    }

    .flow-diagram {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 4px;
    }

    .flow-step {
      display: flex;
      align-items: center;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }

    .flow-step::before {
      content: "‚Üí";
      color: #667eea;
      font-size: 1.5rem;
      margin-right: 1rem;
      font-weight: bold;
    }

    .flow-step:first-child::before {
      content: "1.";
    }

    ul, ol {
      margin-left: 1.5rem;
      margin-top: 0.5rem;
    }

    li {
      margin: 0.5rem 0;
    }

    footer {
      background: #f8f9fa;
      padding: 2rem;
      text-align: center;
      color: #6c757d;
      border-top: 1px solid #dee2e6;
    }

    @media (max-width: 768px) {
      header h1 {
        font-size: 1.8rem;
      }

      .content {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üöÄ WebGL Deployment Guide</h1>
      <p>Complete Tutorial - Terraform + S3 + CloudFront with CI/CD</p>
    </header>

    <div class="content">
      <!-- Table of Contents -->
      <section id="toc" class="toc">
        <h2>üìë Table of Contents</h2>
        <ul>
          <li><a href="#about-project">1. About the Project</a></li>
          <li><a href="#about-services">2. About the Services</a></li>
          <li><a href="#local-setup">3. Local Setup & AWS Keys</a></li>
          <li><a href="#deploy-local">4. Deploy to Dev (Local)</a></li>
          <li><a href="#cicd-setup">5. CI/CD Setup (GitHub Actions)</a></li>
          <li><a href="#workflows">6. Workflows & Environments</a></li>
          <li><a href="#troubleshooting">7. Troubleshooting</a></li>
        </ul>
      </section>

      <!-- About the Project -->
      <section id="about-project">
        <h2>1. About the Project</h2>
        
        <p>This project provides a complete infrastructure-as-code solution for deploying WebGL applications to AWS using Terraform. It automates the creation and management of:</p>
        
        <ul>
          <li><strong>Private S3 Buckets</strong> - Secure storage for WebGL build files</li>
          <li><strong>CloudFront Distributions</strong> - Global CDN for fast content delivery</li>
          <li><strong>IAM Roles & Policies</strong> - Secure access for automated deployments</li>
          <li><strong>Multiple Environments</strong> - Dev, Staging, and Production with isolated state</li>
        </ul>

        <h3>Key Features</h3>
        <ul>
          <li>‚úÖ <strong>Infrastructure as Code</strong> - Everything defined in Terraform</li>
          <li>‚úÖ <strong>Secure by Default</strong> - Private S3 buckets with OAC (Origin Access Control)</li>
          <li>‚úÖ <strong>Multi-Environment</strong> - Separate dev, staging, and prod environments</li>
          <li>‚úÖ <strong>CI/CD Ready</strong> - GitHub Actions workflows included</li>
          <li>‚úÖ <strong>Workspace Isolation</strong> - Each environment has separate state</li>
          <li>‚úÖ <strong>Automated Deployment</strong> - Upload and CloudFront invalidation in one command</li>
        </ul>

        <h3>Project Structure</h3>
        <div class="code-block">
<code>webgl-deploy/
‚îú‚îÄ‚îÄ main.tf              # Root Terraform configuration
‚îú‚îÄ‚îÄ variables.tf          # Variable definitions
‚îú‚îÄ‚îÄ outputs.tf           # Output values
‚îú‚îÄ‚îÄ modules/             # Reusable modules
‚îÇ   ‚îú‚îÄ‚îÄ s3/              # S3 bucket module
‚îÇ   ‚îú‚îÄ‚îÄ cloudfront/      # CloudFront module
‚îÇ   ‚îî‚îÄ‚îÄ iam/             # IAM roles/policies module
‚îú‚îÄ‚îÄ environments/        # Environment configurations
‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îî‚îÄ‚îÄ prod/
‚îú‚îÄ‚îÄ scripts/             # Deployment helper scripts
‚îî‚îÄ‚îÄ .github/workflows/   # CI/CD workflows</code>
        </div>
      </section>

      <!-- About the Services -->
      <section id="about-services">
        <h2>2. About the Services</h2>

        <h3>Amazon S3 (Simple Storage Service)</h3>
        <p><strong>Purpose:</strong> Stores your WebGL build files (HTML, JS, WASM, assets)</p>
        <ul>
          <li><strong>Private Bucket</strong> - Not publicly accessible</li>
          <li><strong>Server-Side Encryption</strong> - AES256 encryption enabled</li>
          <li><strong>Versioning</strong> - Optional (enabled in staging/prod)</li>
          <li><strong>CORS</strong> - Configured for WebGL applications</li>
        </ul>

        <div class="info-box">
          <strong>üîí Security:</strong> The S3 bucket is completely private. Users cannot access files directly. Only CloudFront can access the bucket using OAC (Origin Access Control).
        </div>

        <h3>Amazon CloudFront</h3>
        <p><strong>Purpose:</strong> Global CDN that serves your WebGL application to users worldwide</p>
        <ul>
          <li><strong>Global Distribution</strong> - Content cached at edge locations</li>
          <li><strong>HTTPS Only</strong> - Automatic HTTP to HTTPS redirect</li>
          <li><strong>OAC Integration</strong> - Securely accesses private S3 bucket</li>
          <li><strong>Custom Error Pages</strong> - Handles SPA routing (403/404 ‚Üí index.html)</li>
          <li><strong>Automatic Compression</strong> - Gzip compression enabled</li>
        </ul>

        <h3>Origin Access Control (OAC)</h3>
        <p><strong>Purpose:</strong> Modern security mechanism replacing OAI (Origin Access Identity)</p>
        <ul>
          <li><strong>Secure Access</strong> - Only CloudFront can access S3</li>
          <li><strong>No Public Access</strong> - S3 bucket remains completely private</li>
          <li><strong>Automatic</strong> - Configured automatically by Terraform</li>
        </ul>

        <h3>IAM Roles & Policies</h3>
        <p><strong>Purpose:</strong> Secure access for automated deployments (CI/CD)</p>
        <ul>
          <li><strong>Deployment Policy</strong> - Permissions for S3 upload and CloudFront invalidation</li>
          <li><strong>IAM Role</strong> - Can be assumed by GitHub Actions (OIDC) or EC2</li>
          <li><strong>Temporary Credentials</strong> - No permanent keys stored</li>
        </ul>

        <h3>Architecture Flow</h3>
        <div class="flow-diagram">
          <div class="flow-step"><strong>Developer</strong> - Creates WebGL build</div>
          <div class="flow-step"><strong>Upload</strong> - Files synced to S3 bucket (private)</div>
          <div class="flow-step"><strong>CloudFront</strong> - Serves files via OAC (secure connection)</div>
          <div class="flow-step"><strong>Users</strong> - Access via CloudFront URL (fast, global)</div>
        </div>
      </section>

      <!-- Local Setup -->
      <section id="local-setup">
        <h2>3. Local Setup & AWS Keys</h2>

        <h3>Prerequisites</h3>
        <ol class="step-list">
          <li><strong>AWS CLI</strong> - Install from <a href="https://aws.amazon.com/cli/" target="_blank">aws.amazon.com/cli</a></li>
          <li><strong>Terraform</strong> - Install from <a href="https://www.terraform.io/downloads" target="_blank">terraform.io/downloads</a></li>
          <li><strong>AWS Account</strong> - With appropriate permissions</li>
        </ol>

        <h3>Step 1: Configure AWS Profile</h3>
        <p>This project uses an AWS profile named <code>deploy-config</code> for authentication.</p>

        <h4>Interactive Setup (Recommended)</h4>
        <div class="code-block">
<code>aws configure --profile deploy-config</code>
        </div>

        <p>You will be prompted for:</p>
        <ul>
          <li><strong>AWS Access Key ID</strong> - Your AWS access key</li>
          <li><strong>AWS Secret Access Key</strong> - Your AWS secret key</li>
          <li><strong>Default region</strong> - e.g., <code>us-east-1</code></li>
          <li><strong>Default output format</strong> - <code>json</code> (recommended)</li>
        </ul>

        <h4>Non-Interactive Setup</h4>
        <div class="code-block">
<code>aws configure set aws_access_key_id YOUR_ACCESS_KEY --profile deploy-config
aws configure set aws_secret_access_key YOUR_SECRET_KEY --profile deploy-config
aws configure set region us-east-1 --profile deploy-config
aws configure set output json --profile deploy-config</code>
        </div>

        <h3>Step 2: Verify Profile Configuration</h3>
        <div class="code-block">
<code># List all profiles
aws configure list-profiles

# Verify profile exists
aws configure list-profiles | grep deploy-config

# Test the profile
aws sts get-caller-identity --profile deploy-config</code>
        </div>

        <div class="success-box">
          <strong>‚úÖ Success:</strong> If the last command returns your AWS account ID, the profile is configured correctly.
        </div>

        <h3>Step 3: Clone Repository</h3>
        <div class="code-block">
<code>git clone https://github.com/your-username/webgl-deploy.git
cd webgl-deploy</code>
        </div>

        <h3>Step 4: Initialize Terraform</h3>
        <div class="code-block">
<code>./scripts/init.sh</code>
        </div>

        <p>This will:</p>
        <ul>
          <li>Download required Terraform providers</li>
          <li>Initialize the backend (if configured)</li>
          <li>Show available workspaces</li>
        </ul>
      </section>

      <!-- Deploy to Dev (Local) -->
      <section id="deploy-local">
        <h2>4. Deploy to Dev Environment (Local)</h2>

        <h3>Step 1: Plan Deployment</h3>
        <p>Review what will be created before applying:</p>
        <div class="code-block">
<code>./scripts/plan.sh dev</code>
        </div>

        <p>This will:</p>
        <ul>
          <li>Select/create <code>dev</code> workspace</li>
          <li>Show planned infrastructure changes</li>
          <li>Save plan to <code>tfplan-dev.out</code></li>
        </ul>

        <h3>Step 2: Apply Deployment</h3>
        <p>Create the infrastructure:</p>
        <div class="code-block">
<code>./scripts/apply.sh dev</code>
        </div>

        <p>This will:</p>
        <ul>
          <li>Create S3 bucket (private)</li>
          <li>Create CloudFront distribution</li>
          <li>Configure OAC for secure access</li>
          <li>Display outputs (bucket name, CloudFront URL)</li>
        </ul>

        <div class="warning-box">
          <strong>‚è±Ô∏è Note:</strong> CloudFront distributions take 15-20 minutes to fully deploy. The URL will be available immediately but may show "Distribution not ready" until deployment completes.
        </div>

        <h3>Step 3: Upload Your WebGL Build</h3>
        <p>Upload your build files to S3:</p>
        <div class="code-block">
<code>./scripts/upload.sh dev ./WebGLBuild</code>
        </div>

        <p>This will:</p>
        <ul>
          <li>Sync files to S3 bucket</li>
          <li>Create CloudFront invalidation</li>
          <li>Clear cache so users get latest version</li>
        </ul>

        <h3>Step 4: View Outputs</h3>
        <p>Get deployment information:</p>
        <div class="code-block">
<code>./scripts/outputs.sh dev</code>
        </div>

        <p>Key outputs:</p>
        <ul>
          <li><strong>s3_bucket_id</strong> - S3 bucket name</li>
          <li><strong>cloudfront_distribution_domain_name</strong> - CloudFront URL</li>
          <li><strong>deployment_url</strong> - Full HTTPS URL to access your app</li>
        </ul>

        <h3>Complete Local Deployment Workflow</h3>
        <div class="code-block">
<code># 1. Initialize (first time only)
./scripts/init.sh

# 2. Plan deployment
./scripts/plan.sh dev

# 3. Apply infrastructure
./scripts/apply.sh dev

# 4. Upload build files
./scripts/upload.sh dev ./WebGLBuild

# 5. Get deployment URL
./scripts/outputs.sh dev</code>
        </div>
      </section>

      <!-- CI/CD Setup -->
      <section id="cicd-setup">
        <h2>5. CI/CD Setup (GitHub Actions)</h2>

        <h3>Overview</h3>
        <p>CI/CD allows automatic deployment when you push code to GitHub. No manual deployment needed!</p>

        <div class="info-box">
          <strong>üîê Security:</strong> CI/CD uses IAM roles (OIDC) instead of AWS keys. No secrets stored in GitHub!
        </div>

        <h3>Step 1: Configure Remote State & IAM</h3>
        <p>Update the backend files and create IAM roles with the helper script.</p>
        <div class="code-block">
<code># 1. Edit backend/staging.hcl and backend/prod.hcl
#    - bucket: your Terraform state bucket
#    - dynamodb_table: your lock table

# 2. Create IAM role + policy for GitHub Actions (one-time)
AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query Account --output text)
./scripts/setup-iam-oidc.sh staging $AWS_ACCOUNT_ID your-org/your-repo
./scripts/setup-iam-oidc.sh prod     $AWS_ACCOUNT_ID your-org/your-repo
</code>
        </div>

        <h3>Step 2: Add GitHub Secrets</h3>
        <p>Create repository secrets for:</p>
        <ul>
          <li><code>AWS_ACCOUNT_ID</code></li>
          <li><code>AWS_ROLE_ARN_STAGING</code></li>
          <li><code>AWS_ROLE_ARN_PROD</code></li>
        </ul>

        <h3>Step 3: Apply Terraform</h3>
        <div class="code-block">
<code># Deploy staging infrastructure with IAM roles
./scripts/plan.sh staging
./scripts/apply.sh staging

# Deploy production infrastructure with IAM roles
./scripts/plan.sh prod
./scripts/apply.sh prod</code>
        </div>

        <h3>Step 4: Capture the Role ARNs</h3>
        <p>The setup script prints the role ARNs. Copy them when <code>setup-iam-oidc.sh</code> finishes or retrieve them later from the IAM console.</p>

        <h3>Step 5: Add GitHub Secrets</h3>
        <ol class="step-list">
          <li>Go to your GitHub repository</li>
          <li>Click <strong>Settings</strong> ‚Üí <strong>Secrets and variables</strong> ‚Üí <strong>Actions</strong></li>
          <li>Click <strong>New repository secret</strong></li>
          <li>Add these secrets:
            <ul>
              <li><strong>Name:</strong> <code>AWS_ACCOUNT_ID</code><br>
                  <strong>Value:</strong> <code>123456789012</code> (your AWS account ID)</li>
              <li><strong>Name:</strong> <code>AWS_ROLE_ARN_STAGING</code><br>
                  <strong>Value:</strong> <code>arn:aws:iam::ACCOUNT:role/webgl-staging-deployment-role</code></li>
              <li><strong>Name:</strong> <code>AWS_ROLE_ARN_PROD</code><br>
                  <strong>Value:</strong> <code>arn:aws:iam::ACCOUNT:role/webgl-prod-deployment-role</code></li>
            </ul>
          </li>
        </ol>

        <h3>Step 6: Workflows Are Already Configured!</h3>
        <p>The CI/CD workflows are already in <code>.github/workflows/</code>:</p>
        <ul>
          <li><code>deploy-dev.yml</code> - Deploys on push to <code>dev</code> branch</li>
          <li><code>deploy-staging.yml</code> - Deploys on push to <code>staging</code> branch</li>
          <li><code>deploy-prod.yml</code> - Deploys on push to <code>main</code> branch</li>
        </ul>

        <h3>Step 7: Test CI/CD</h3>
        <p>Push code to trigger deployment:</p>
        <div class="code-block">
<code># Push to dev branch
git push origin dev
# ‚Üí Triggers dev deployment workflow

# Merge dev to staging
git checkout staging
git merge dev
git push origin staging
# ‚Üí Triggers staging deployment workflow

# Merge staging to main
git checkout main
git merge staging
git push origin main
# ‚Üí Triggers production deployment workflow</code>
        </div>

        <h3>How CI/CD Works</h3>
        <div class="flow-diagram">
          <div class="flow-step"><strong>Push to GitHub</strong> - Code pushed to branch</div>
          <div class="flow-step"><strong>GitHub Actions Triggers</strong> - Workflow starts automatically</div>
          <div class="flow-step"><strong>OIDC Authentication</strong> - GitHub requests token from AWS</div>
          <div class="flow-step"><strong>Assume IAM Role</strong> - Gets temporary credentials</div>
          <div class="flow-step"><strong>Terraform Deploys</strong> - Creates/updates infrastructure</div>
          <div class="flow-step"><strong>Upload to S3</strong> - Build files uploaded</div>
          <div class="flow-step"><strong>Invalidate CloudFront</strong> - Cache cleared</div>
          <div class="flow-step"><strong>Deployment Complete</strong> - Your app is live!</div>
        </div>
      </section>

      <!-- Workflows & Environments -->
      <section id="workflows">
        <h2>6. Workflows & Different Environments</h2>

        <h3>Branch Strategy</h3>
        <p>This project uses a three-branch workflow:</p>
        <table>
          <thead>
            <tr>
              <th>Branch</th>
              <th>Environment</th>
              <th>Deployment</th>
              <th>Purpose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>dev</code></td>
              <td>Development</td>
              <td>Auto (on push)</td>
              <td>Fast iteration, testing</td>
            </tr>
            <tr>
              <td><code>staging</code></td>
              <td>Staging</td>
              <td>Auto (on push)</td>
              <td>Pre-production testing</td>
            </tr>
            <tr>
              <td><code>main</code></td>
              <td>Production</td>
              <td>Auto (with optional approval)</td>
              <td>Live production environment</td>
            </tr>
          </tbody>
        </table>

        <h3>Deployment Workflow</h3>
        <div class="flow-diagram">
          <div class="flow-step"><strong>Local Development</strong> - Test on dev locally</div>
          <div class="flow-step"><strong>Push to dev</strong> - <code>git push origin dev</code></div>
          <div class="flow-step"><strong>Auto-deploy dev</strong> - CI/CD deploys to dev environment</div>
          <div class="flow-step"><strong>Merge to staging</strong> - Create PR: dev ‚Üí staging</div>
          <div class="flow-step"><strong>Auto-deploy staging</strong> - CI/CD deploys to staging</div>
          <div class="flow-step"><strong>Merge to main</strong> - Create PR: staging ‚Üí main</div>
          <div class="flow-step"><strong>Auto-deploy prod</strong> - CI/CD deploys to production</div>
        </div>

        <h3>Terraform Workspaces</h3>
        <p>Each environment uses a separate Terraform workspace for state isolation:</p>
        <ul>
          <li><strong>dev workspace</strong> - Manages dev environment state</li>
          <li><strong>staging workspace</strong> - Manages staging environment state</li>
          <li><strong>prod workspace</strong> - Manages production environment state</li>
        </ul>

        <div class="info-box">
          <strong>üîí State Isolation:</strong> Each environment has its own state file. Destroying one environment doesn't affect others.
        </div>

        <h3>Managing Multiple Environments</h3>

        <h4>Deploy to Specific Environment</h4>
        <div class="code-block">
<code># Deploy dev
./scripts/plan.sh dev
./scripts/apply.sh dev

# Deploy staging
./scripts/plan.sh staging
./scripts/apply.sh staging

# Deploy prod
./scripts/plan.sh prod
./scripts/apply.sh prod</code>
        </div>

        <h4>View Environment Outputs</h4>
        <div class="code-block">
<code>./scripts/outputs.sh dev      # Dev environment
./scripts/outputs.sh staging    # Staging environment
./scripts/outputs.sh prod      # Production environment</code>
        </div>

        <h4>Destroy Specific Environment</h4>
        <div class="code-block">
<code># Destroy only staging (dev and prod remain)
./scripts/destroy.sh staging

# Destroy only dev
./scripts/destroy.sh dev</code>
        </div>

        <h3>Branch Protection Rules</h3>
        <p>To enforce the workflow, set up branch protection in GitHub:</p>
        <ol class="step-list">
          <li>Go to <strong>Repository Settings</strong> ‚Üí <strong>Branches</strong></li>
          <li>Add rule for <code>staging</code>:
            <ul>
              <li>Require pull request before merging</li>
              <li>Do not allow deleting this branch</li>
              <li>Restrict direct pushes</li>
            </ul>
          </li>
          <li>Add rule for <code>main</code>:
            <ul>
              <li>Require pull request before merging</li>
              <li>Require approvals (optional)</li>
              <li>Do not allow deleting this branch</li>
              <li>Restrict direct pushes</li>
            </ul>
          </li>
          <li>Add rule for <code>dev</code>:
            <ul>
              <li>Do not allow deleting this branch</li>
            </ul>
          </li>
        </ol>

        <div class="warning-box">
          <strong>‚ö†Ô∏è Important:</strong> The <code>branch-protection.yml</code> workflow automatically validates PR rules. It blocks invalid merges (e.g., direct PR to main from feature branch).
        </div>

        <h3>Environment Configuration</h3>
        <p>Each environment has its own configuration file:</p>
        <ul>
          <li><code>environments/dev/terraform.tfvars</code> - Dev settings</li>
          <li><code>environments/staging/terraform.tfvars</code> - Staging settings</li>
          <li><code>environments/prod/terraform.tfvars</code> - Production settings</li>
        </ul>

        <p>Key differences:</p>
        <table>
          <thead>
            <tr>
              <th>Setting</th>
              <th>Dev</th>
              <th>Staging</th>
              <th>Prod</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>IAM Roles</td>
              <td>Disabled</td>
              <td>Enabled (OIDC)</td>
              <td>Enabled (OIDC)</td>
            </tr>
            <tr>
              <td>Cache TTL</td>
              <td>1 hour</td>
              <td>1 day</td>
              <td>1 year</td>
            </tr>
            <tr>
              <td>Price Class</td>
              <td>US/Europe</td>
              <td>US/Europe</td>
              <td>Global</td>
            </tr>
            <tr>
              <td>Versioning</td>
              <td>Disabled</td>
              <td>Enabled</td>
              <td>Enabled</td>
            </tr>
          </tbody>
        </table>
      </section>

      <!-- Troubleshooting -->
      <section id="troubleshooting">
        <h2>7. Troubleshooting</h2>

        <h3>Common Issues</h3>

        <h4>Issue: "AWS profile 'deploy-config' is not configured"</h4>
        <p><strong>Solution:</strong></p>
        <div class="code-block">
<code>aws configure --profile deploy-config</code>
        </div>

        <h4>Issue: "Workspace doesn't exist"</h4>
        <p><strong>Solution:</strong> Workspace is created automatically on first plan/apply. Just run:</p>
        <div class="code-block">
<code>./scripts/plan.sh dev</code>
        </div>

        <h4>Issue: "Unable to determine S3 bucket name"</h4>
        <p><strong>Solution:</strong> Make sure you've run <code>terraform apply</code> first:</p>
        <div class="code-block">
<code>./scripts/apply.sh dev</code>
        </div>

        <h4>Issue: CI/CD workflow fails with "Role not found"</h4>
        <p><strong>Solution:</strong></p>
        <ol>
          <li>Verify IAM roles are created: <code>./scripts/outputs.sh staging</code></li>
          <li>Check GitHub Secrets are set correctly</li>
          <li>Verify OIDC is configured in <code>terraform.tfvars</code></li>
        </ol>

        <h4>Issue: CloudFront shows "Distribution not ready"</h4>
        <p><strong>Solution:</strong> Wait 15-20 minutes. CloudFront distributions take time to deploy globally.</p>

        <h3>Useful Commands</h3>
        <div class="code-block">
<code># List all workspaces
terraform workspace list

# Show current workspace
terraform workspace show

# Switch workspace manually
terraform workspace select staging

# View Terraform state
terraform state list

# Check AWS profile
aws sts get-caller-identity --profile deploy-config</code>
        </div>
      </section>

      <!-- Quick Reference -->
      <section>
        <h2>üìö Quick Reference</h2>
        
        <h3>Local Deployment Commands</h3>
        <div class="code-block">
<code>./scripts/init.sh              # Initialize Terraform
./scripts/plan.sh dev            # Plan dev deployment
./scripts/apply.sh dev           # Deploy to dev
./scripts/upload.sh dev ./build  # Upload files
./scripts/outputs.sh dev         # View outputs
./scripts/destroy.sh dev         # Destroy dev</code>
        </div>

        <h3>Git Workflow</h3>
        <div class="code-block">
<code># Work on feature
git checkout -b feature/my-feature dev
# ... make changes ...
git push origin feature/my-feature

# Merge to dev
git checkout dev
git merge feature/my-feature
git push origin dev  # ‚Üí Auto-deploys to dev

# Merge to staging
git checkout staging
git merge dev
git push origin staging  # ‚Üí Auto-deploys to staging

# Merge to main
git checkout main
git merge staging
git push origin main  # ‚Üí Auto-deploys to prod</code>
        </div>

        <h3>Documentation Files</h3>
        <ul>
          <li><code>README.md</code> - Main documentation</li>
          <li><code>WORKSPACES_GUIDE.md</code> - Workspace management</li>
          <li><code>GITHUB_ACTIONS_SETUP.md</code> - CI/CD setup</li>
          <li><code>IAM_ROLE_GUIDE.md</code> - IAM roles explained</li>
          <li><code>.github/BRANCH_PROTECTION_SETUP.md</code> - Branch protection</li>
        </ul>
      </section>
    </div>

    <footer>
      <p><strong>WebGL Deployment Infrastructure</strong></p>
      <p>Served from Amazon S3 + CloudFront via Terraform</p>
      <p>Replace this file with your actual WebGL build after deployment</p>
    </footer>
  </div>
</body>
</html>
